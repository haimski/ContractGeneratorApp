# 🚀 Vercel Deployment Guide

Complete guide for deploying the Quote Generator MERN application to Vercel.

---

## 📋 Prerequisites

Before deploying, ensure you have:

- ✅ A [Vercel account](https://vercel.com/signup) (free tier works)
- ✅ Your code pushed to a Git repository (GitHub, GitLab, or Bitbucket)
- ✅ [Vercel CLI](https://vercel.com/cli) installed (optional, for CLI deployment)

---

## 🏗️ Architecture Overview

Your app will be deployed as:

- **Frontend**: Static React build served from root
- **Backend**: Serverless API functions in `/api` directory
- **Sessions**: In-memory (suitable for demo/low-traffic apps)

```
your-app.vercel.app/
├── /                    → React frontend
├── /api/health          → Serverless function
├── /api/webhook         → Serverless function
└── /api/submit-quote    → Serverless function
```

---

## 🔐 Step 1: Prepare Environment Variables

### Generate a Secure Session Secret

Run this command to generate a random secret:

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

Copy the output - you'll need it for Vercel.

---

## 🌐 Step 2: Deploy to Vercel (Web Interface)

### Option A: Deploy via Vercel Dashboard (Recommended)

1. **Go to [Vercel Dashboard](https://vercel.com/dashboard)**

2. **Click "Add New" → "Project"**

3. **Import your Git repository**
   - Select your repository
   - Click "Import"

4. **Configure Project Settings**
   - **Framework Preset**: Vite
   - **Root Directory**: `./` (leave as root)
   - **Build Command**: `npm run build`
   - **Output Directory**: `client/dist`
   - **Install Command**: `npm run install-all`

5. **Add Environment Variables**
   
   Click "Environment Variables" and add:
   
   | Name | Value | Environment |
   |------|-------|-------------|
   | `SESSION_SECRET` | `<your-generated-secret>` | Production, Preview, Development |
   | `NODE_ENV` | `production` | Production |
   | `VERCEL_ANALYTICS_ID` | `<auto-generated>` | All (if using analytics) |

6. **Click "Deploy"**

   Wait 2-3 minutes for the build to complete.

7. **Your app is live!** 🎉
   
   Visit: `https://your-app.vercel.app`

---

### Option B: Deploy via Vercel CLI

```bash
# Install Vercel CLI globally
npm install -g vercel

# Login to Vercel
vercel login

# Deploy (from project root)
vercel

# Follow the prompts:
# - Set up and deploy? Yes
# - Which scope? Select your account
# - Link to existing project? No
# - Project name? quote-generator (or your choice)
# - Directory? ./ (root)
# - Override settings? No

# Add environment variables
vercel env add SESSION_SECRET
# Paste your generated secret when prompted

# Deploy to production
vercel --prod
```

---

## 📊 Step 3: Enable Vercel Analytics

### Install Analytics Package

```bash
cd client
npm install @vercel/analytics
```

### Update client/src/main.jsx

Add analytics to your React app:

```javascript
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './index.css'
import { Analytics } from '@vercel/analytics/react'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
    <Analytics />
  </React.StrictMode>,
)
```

### Commit and Push

```bash
git add .
git commit -m "Add Vercel Analytics"
git push
```

Vercel will automatically redeploy with analytics enabled.

---

## ✅ Step 4: Test Your Deployment

### 1. Test Backend API

Open in browser:
```
https://your-app.vercel.app/api/health
```

**Expected response:**
```json
{"status":"ok","message":"Quote Generator API is running"}
```

### 2. Test Frontend

Visit:
```
https://your-app.vercel.app
```

You should see the Quote Generator home page.

### 3. Test Full Workflow

1. Enter a Make.com webhook URL
2. Fill out the form
3. Generate preview
4. Submit to Make.com
5. Verify webhook receives data

---

## 🔧 Configuration Files Reference

### `/vercel.json`

Main Vercel configuration:

```json
{
  "version": 2,
  "buildCommand": "cd client && npm install && npm run build",
  "outputDirectory": "client/dist",
  "installCommand": "npm install && cd server && npm install && cd ../client && npm install",
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "/api/:path*"
    },
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ],
  "functions": {
    "api/**/*.js": {
      "memory": 1024,
      "maxDuration": 10
    }
  }
}
```

### `/api/index.js`

Serverless function handler (already created).

---

## 🌍 Custom Domain (Optional)

### Add Your Own Domain

1. Go to your project in Vercel Dashboard
2. Click "Settings" → "Domains"
3. Add your domain (e.g., `quotes.yourdomain.com`)
4. Follow DNS configuration instructions
5. Wait for DNS propagation (5-60 minutes)

---

## 🐛 Troubleshooting

### ❌ Build Failed

**Check build logs in Vercel dashboard:**

1. Go to Deployments
2. Click on failed deployment
3. Check "Build Logs"

**Common issues:**
- Missing dependencies: Run `npm install` locally first
- Build command error: Verify `package.json` scripts
- Environment variables: Ensure all required vars are set

### ❌ API Returns 404

**Solution:**
- Verify `/api/index.js` exists
- Check `vercel.json` rewrites configuration
- Redeploy the project

### ❌ Session Not Persisting

**Issue:** In-memory sessions don't persist across serverless invocations.

**Solutions:**
1. **For production**: Implement Redis session store
2. **For demo**: Accept that sessions may be lost (current setup)
3. **Alternative**: Use JWT tokens or localStorage

### ❌ CORS Errors

**Solution:**

Update `/api/index.js` to include your domain:

```javascript
const allowedOrigins = [
  'http://localhost:3000',
  'https://your-app.vercel.app',
  'https://your-custom-domain.com'
];
```

Commit and redeploy.

### ❌ Environment Variables Not Working

**Solution:**
1. Go to Project Settings → Environment Variables
2. Verify all variables are set
3. Redeploy (environment changes require redeployment)

---

## 🔄 Continuous Deployment

Vercel automatically deploys when you push to your repository:

- **Push to `main` branch** → Production deployment
- **Push to other branches** → Preview deployment
- **Pull requests** → Preview deployment with unique URL

### Preview Deployments

Every PR gets a unique preview URL:
```
https://your-app-git-branch-name-username.vercel.app
```

---

## 📈 Monitoring & Analytics

### View Analytics

1. Go to your project in Vercel Dashboard
2. Click "Analytics" tab
3. View:
   - Page views
   - Unique visitors
   - Top pages
   - Real-time data

### View Logs

1. Go to "Deployments"
2. Click on a deployment
3. Click "Functions" tab
4. View serverless function logs

---

## ⚠️ Important Notes

### Session Storage Limitations

The current setup uses **in-memory sessions** which have limitations:

- ✅ Works for demo and low-traffic apps
- ✅ Simple setup, no external dependencies
- ❌ Sessions may not persist between requests
- ❌ Not suitable for high-traffic production

**For production with multiple users:**

1. **Use Redis** (recommended):
   ```bash
   npm install connect-redis redis
   ```
   
2. **Or use JWT tokens** instead of sessions

3. **Or use client-side localStorage** (less secure)

### Serverless Function Limits

Vercel free tier limits:
- **Execution time**: 10 seconds max
- **Memory**: 1024 MB
- **Deployments**: 100/day
- **Bandwidth**: 100 GB/month

For higher limits, upgrade to Pro plan.

---

## 🚀 Next Steps

After successful deployment:

1. ✅ Test all features thoroughly
2. ✅ Set up custom domain (optional)
3. ✅ Enable Vercel Analytics
4. ✅ Monitor logs and performance
5. ✅ Consider implementing Redis for sessions (production)
6. ✅ Set up error monitoring (Sentry, etc.)

---

## 📞 Support

- **Vercel Docs**: [vercel.com/docs](https://vercel.com/docs)
- **Vercel Support**: [vercel.com/support](https://vercel.com/support)
- **Community**: [github.com/vercel/vercel/discussions](https://github.com/vercel/vercel/discussions)

---

**Happy Deploying!** 🎉
